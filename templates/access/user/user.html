{% extends 'main/base.html' %}
{% block title %} صفحه کاربر {% endblock %}
{% block navitem_right %}

{% endblock %}
{% block navitem_left %}
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('logout') }}">خروج</a>
    </li>
{% endblock %}

{% block content %}
    <h2 style="text-align: center">برچسب گذاری</h2>

    <h5 style="margin-top: 60px">افزودن برچسب</h5>

    <form action="{{ url_for('read_one_row_data') }}" method="post" style="margin-top: 30px; margin-right: 20px">
        {{ read_one_row_form.hidden_tag() }}
        {{ read_one_row_form.row_id(class="form-control", type="hidden") }}
        {{ read_one_row_form.username(class="form-control", type="hidden") }}
        <div class="form-group">
            <strong>{{ read_one_row_form.data.label }}:</strong>
            {% if read_one_row_form.data.data is string %}
                {{ read_one_row_form.data(class="form-control", readonly=True) }}
            {% elif read_one_row_form.data.data is mapping %}
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>کلید</th>
                        <th>مقدار</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for key, value in read_one_row_form.data.data.items() %}
                        <tr>
                            <td>{{ key }}</td>
                            <td>{{ value }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% else %}
                -
            {% endif %}
        </div>
    </form>

    <form action="{{ url_for('add_label') }}" method="post" style="margin-top: 20px; margin-right: 20px">
        {{ add_label_form.hidden_tag() }}
        {{ add_label_form.row_id(class="form-control", type="hidden") }}
        {{ add_label_form.username(class="form-control", type="hidden") }}
        <div class="form-group">
            {{ add_label_form.label.label }}
            {{ add_label_form.label(class="form-control") }}
        </div>
        <div class="form-group">
            {{ add_label_form.submit(class="btn btn-primary btn-sm", style="margin-top: 10px") }}
        </div>
    </form>

    {% if recent_labels %}
        <h5 style="margin-top: 50px">داده و برچسب های اخیر</h5>
        <div style="overflow-x: auto; padding-right: 20px; margin-top: 20px">

            <table class="table table-bordered">
                <thead>
                <tr>
                    <th>داده</th>
                    <th>ویرایش برچسب</th>
                </tr>
                </thead>
                <tbody>
                {% for label in recent_labels %}
                    <tr>
                        <td>
                            {% if label.data is string %}
                                {{ label.data }}
                            {% elif label.data is mapping %}
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>کلید</th>
                                        <th>مقدار</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for key, value in label.data.items() %}
                                        <tr>
                                            <td>{{ key }}</td>
                                            <td>{{ value }}</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            <form action="{{ url_for('edit_label') }}" method="post">
                                {{ form.csrf_token }}
                                <input type="hidden" name="row_id" value="{{ label.id }}">
                                <select name="label_value" class="form-control"
                                        style="display: inline-block; width: auto;">
                                    {% for option in label_options %}
                                        <option value="{{ option }}"
                                                {% if label.labels[current_user.username] == option %}selected{% endif %}>{{ option }}</option>
                                    {% endfor %}
                                </select>
                                <button type="submit" class="btn btn-sm btn-primary" style="margin-top: 5px">ویرایش
                                </button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

    {% endif %}

{% endblock %}
